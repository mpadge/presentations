---
title: "Assessment and Standardization of R Packages for Statistical Analysis by ROpenSci"
author: "Mark Padgham & Noam Ross<br>rOpenSci & EcoHealth Alliance<br>MÃ¼nster, Germany & New York, USA"
output:
      xaringan::moon_reader:
            lib_dir: libs
            css: xaringan-themer.css
            self_contained: true
            mathjax: null
            nature:
                  highlightStyle: github
                  highlightLines: true
                  countIncrementalSlides: false
---

```{r xaringan, include = FALSE}
library(xaringanthemer)
source ("myxaringantheme.R")
```

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)# suppress version num in subdir name

knitr::opts_chunk$set(cache = TRUE,
                      collapse = TRUE,
                      warning = FALSE)
                      #message = FALSE)
library (autotest)
if (packageVersion ("autotest") < '0.0.2.81')
    stop ("autotest package is not at latest version")
```

class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# rOpenSci: Transforming science through open data, software & reproducibility

"*We help develop R packages for the sciences via community driven learning,
review and maintenance of contributed software in the R ecosystem*"

---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# rOpenSci & Software Peer Review

"packages contributed by the community undergo a transparent, constructive, non
adversarial and open review process."


---
class: center, middle, inverse
background-image: url(img/devguide-cover.png)
background-size: contain
background-position: 50% 50%

--

# `devguide.ropensci.org`

---
class: center, middle, inverse
background-image: url(img/devguide-ch1.png)
background-size: contain
background-position: 50% 50%

---
class: center, middle, inverse
background-image: url(img/devguide-ch2.png)
background-size: contain
background-position: 50% 50%

---
class: center, middle, inverse
background-image: url(img/devguide-ch3.png)
background-size: contain
background-position: 50% 50%


---
class: center, top, inverse
background-image: url(img/devguide-cover.png)
background-size: contain
background-position: 50% 50%

--

.red[
recommendations<br>not principles
]

--

.red[
semi-structured<br>
collection of<br>
best practices
]


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# rOpenSci & Software Peer Review: Scope

Current scope includes software for:

.left-column[

- data retrieval
- data extraction
- data munging
- data deposition
- data validation and testing
- workflow automation
- version control
- citation management and bibliometrics

]

.right-column[

- scientific software wrappers
- field and laboratory reproducibility tools
- database software bindings
- geospatial data
- text analysis

  ]

---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# rOpenSci & Software Peer Review: Scope

Current scope ~~includes~~ does NOT include software for:

- statistics

... even through R is an<br>"environment for statistical computing"

---
class: center, top
background-image: url(img/SloanLogo-1B-SMALL-Gold-Blue.png)
background-size: contain
background-position: 50% 50%

--

# Expanding Software Peer Review

--

.fontBIG[ Expand Scope<br>to include<br>Statistical Software ]

---
class: left, top, inverse
background-image: url(img/icon_lettering_color_large-dark.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Peer Review


- ### &#9989; 1. Define "Statistical Software"

- ### &#9989; 2. Develop Standards for Statistical Software

- ### &#9989; 3. Develop Tools to Aid Software Development

- ### &#9989; 4. Automate System for Software Submissions

- ### &#9989; 5. Open Peer Review System to Statistical Software

<br><br>
(Status: September 2021)

---
class: left, top, inverse
background-image: url(img/icon_lettering_color_large-dark.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Peer Review

<br>
## `devguide.ropensci.org` +<br>`stats-devguide.ropensci.org`

---
class: left, top, inverse
background-image: url(img/icon_lettering_color_large-dark.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Peer Review


- ### &#9989; 1. Define "Statistical Software"


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Peer Review

## What is Statistical Software?

- Empirical Analysis

- Data: All abstracts from major statistics conferences (JSM, SDSS, ...
  n ~ 20,000)

- Methods: Natural Language Processing &#8594; concept clusters &#8594; network
  analyses

- Results ...


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Peer Review

## What is Statistical Software?


.left-column[

- Bayesian and Monte Carlo
- Regression and Supervised Learning
- Dimensionality Reduction, Clustering, and Unsupervised Learning
- Exploratory Data Analysis (EDA) and Summary Statistics

]

.right-column[


- Time Series Analyses
- Machine Learning
- Spatial Analyses
- ~~Wrapper Packages~~
- ~~Network Analysis~~
- ~~Probability Distributions~~
- ~~Workflow Support~~

]

---
class: left, top, inverse
background-image: url(img/icon_lettering_color_large-dark.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Peer Review


- ### &#9989; 1. Define "Statistical Software"

--

- ### &#9989; 2. Develop Standards for Statistical Software

---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Standards

## Methodology (Specific):

- Collate lists of software packages in each category

- "Read" code in each package

- "Use" each package to provide insight into:
    - User interfaces
    - Package design
    - Documentation
    - ...?

- Take notes on good and bad practices

- Translate these into general principles


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Standards

## Methodology (General):

- Translate observed practices into principles

- Write these principles as standards

- Selectively elevate standards to *General*

- Iterate, remove, add, refine, restructure standards


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Standards

## Results

- 40 General Standards

- 265 Category-Specific Standards

- 7 Categories

- Four Further Categories in Development

--

- `devguide.ropensci.org`: 27,000 words

- `stats-devguide.ropensci.org`: 48,000 words


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Standards

### [General & Category-Specific Standards](https://stats-devguide.ropensci.org/standards.html)<br>generally divided into standards for:

- Documentation

- Input Structures

- Algorithms

- Output Structures

- Testing

---
class: left, top, inverse
background-image: url(img/icon_lettering_color_large-dark.png)
background-size: contain
background-position: 50% 50%

# Statistical Software Peer Review


- ### &#9989; 1. Define "Statistical Software"

- ### &#9989; 2. Develop Standards for Statistical Software

- ### &#9989; 3. Develop Tools to Aid Software Development


---
class: left, top, inverse
background-image: url(img/package-flow.png)
background-size: contain
background-position: 50% 50%

---
class: center, middle, inverse

# The 'srr' package

## `srr` = "Software Review Roclets"

(A "roclet" is a documentation engine,<br>or "doclet", for the **R** language.)

## github.com/ropensci-review-tools

## search: "ropensci srr"



---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'srr' package: How?

- [Enable standards compliance statements to be included within code itself, at
  the point(s) at which each standard is actually
  addressed.](https://ropensci-review-tools.github.io/roreviewapi/static/tsbox_srraad57cea.html)

--

- One function dumps full text of standards in file
  `R/srr-stats-standards.R`

- All are initially tagged `@srrstatsTODO`

- Standards are addressed by changing tag to `@srrstats` and moving to location
  within code where standard is addressed


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'srr' package: How?

- Reports on standards compliance automatically generated locally each time
  documentation is updated.

```{r roxygenise-demo1, eval = FALSE}
roxygen2::roxygenise(path)
```

```{r roxygenise-demo1-output, echo = FALSE, message = TRUE, collapse = TRUE}
cli::cli_alert_info ("Loading demo")
cli::cli_h1 ("rOpenSci Statistical Software Standards")
cli::cli_h3 ("@srrstats standards:")
cli::cli_li ("[G1.0] in function 'addtwo()' on line#11 of file [R/test.R]")
```

---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'srr' package: Summary

- Insert standards into package with one line of code

- Comply with standards

- Update documentation to automatically generate compliance report

- Generate hyperlinked `html` version with `srr_report()` function

- Also extensible, with alternative standards<br>substituted by modifying
  a single URL


---
class: left, top, inverse
background-image: url(img/package-flow.png)
background-size: contain
background-position: 50% 50%

---
class: center, middle, inverse

# autotest

## github.com/ropensci-review-tools

## search: "ropensci autotest"


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'autotest' package: Why?

## rOpenSci Software Peer Review

- Reviewers often the first "external" users of submitted packages

- Quickly uncover bugs, distracting reviews from higher-level focus on software quality

- A tool to help uncover bugs prior to submission should increase software quality


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'autotest' package: How?


- A form of "mutation testing"

- Extracts documented example code to identify all inputs to, and outputs from,
  all functions

- Mutates those inputs

- Also matches input and output types to descriptions



---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'autotest' package

Example: `autotest`ing the `stats` package

```{r at-stats-first, eval = FALSE}
a <- autotest_package (package = "stats",
                       functions = "var",
                       test = FALSE) # default
```

- `package` argument can be name of an installed package, or path to local source directory.

- `functions` argument can restrict tests to specified functions only.

- `test = FALSE` returns a list of tests without actually performing them.


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'autotest' package

Example: `autotest`ing the `stats` package

```{r at-stats, eval = FALSE}
a <- autotest_package (package = "stats",
                       functions = "var",
                       test = FALSE) # default
```
```{r at-stats1-cli, echo = FALSE}
cli::cli_h3 ("autotesting stats")
cli::cli_alert_success ("[1 / 4]: var")
cli::cli_alert_success ("[2 / 4]: cor")
cli::cli_alert_success ("[3 / 4]: cov")
cli::cli_alert_success ("[4 / 4]: cov")
```
```{r dima-F, eval = FALSE}
dim (a)
```
```{r at-stats-save, echo = FALSE, eval = TRUE}
if (!file.exists ("data/stats-var-FALSE.Rds")) {
    a <- autotest_package (package = "stats",
                           functions = "var",
                           test = FALSE) # default
    saveRDS (a, "data/stats-var-FALSE.Rds")
}
```
```{r at-stats-dim, echo = FALSE, eval = TRUE}
c (150, 9)
```

&#8594; 150 tests on 4 functions


---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'autotest' package

Example: `autotest`ing the `stats` package

```{r at-stats-F-out, echo = FALSE}
a <- readRDS ("data/stats-var-FALSE.Rds")
a
```

---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'autotest' package

Example: `autotest`ing the `stats` package

```{r at-stats-F-test-types, echo = FALSE}
a <- readRDS ("data/stats-var-FALSE.Rds")
x <- table (a$test_name)
data.frame (test_name = names (x),
            n = as.integer (x))
```

---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'autotest' package

Example: `autotest`ing the `stats` package

```{r at-stats2, eval = FALSE}
a <- autotest_package (package = "stats",
                       functions = "var",
                       test = TRUE) # takes 20-30 seconds
```
```{r at-stats2-cli, echo = FALSE}
cli::cli_h3 ("autotesting stats")
cli::cli_alert_success ("[1 / 4]: var")
cli::cli_alert_success ("[2 / 4]: cor")
cli::cli_alert_success ("[3 / 4]: cov")
cli::cli_alert_success ("[4 / 4]: cov")
```
```{r dima-T, eval = FALSE}
dim (a)
```
```{r at-stats-T-save, echo = FALSE, eval = TRUE}
if (!file.exists ("data/stats-var-TRUE.Rds")) {
    a <- autotest_package (package = "stats",
                           functions = "var",
                           test = TRUE) # takes 20-30 seconds
    a <- a [order (a$test_name), ]
    saveRDS (a, "data/stats-var-TRUE.Rds")
}
```
```{r at-stats-T-dim, echo = FALSE, eval = TRUE}
c (15, 9)
```

150 tests &#8594; 15 results

---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'autotest' package

Example: `autotest`ing the `stats` package

```{r at-stats-T-out, echo = FALSE}
a <- readRDS ("data/stats-var-TRUE.Rds")
a
```

---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'autotest' package

Example: `autotest`ing the `stats` package

- Use `DT` package to inspect results!


```{r use-DT, eval = FALSE}
a <- autotest_package (package = "stats",
                       functions = "var",
                       test = TRUE) # takes 20-30 seconds
DT::datatable (a)
```

---
class: left, top
background-image: url(img/stats-var-TRUE.png)
background-size: contain
background-position: 50% 50%

---
class: left, top
background-image: url(img/icon_lettering_color_large-faded.png)
background-size: contain
background-position: 50% 50%

# The 'autotest' package

Example: `autotest`ing the `stats` package

```{r at-stats-5, eval = FALSE}
a <- autotest_package (package = "stats",
                       functions = "var",
                       test = TRUE)
```

- `stats` package is algorithmially robust

- But `autotest` reveals a few gaps in documentation!



---
class: left, top, inverse
background-image: url(img/package-flow.png)
background-size: contain
background-position: 50% 50%


---
class: left, top, inverse
background-image: url(img/tsbox-pkgcheck.png)
background-size: contain
background-position: 50% 50%

---
class: left, top, inverse
background-image: url(img/tsbox.png)
background-size: contain
background-position: 50% 50%


---
class: left, middle, inverse

# Statistical Software Peer Review

- Now accepting submissions

- Search "rOpenSci statistical software"

- `stats-devguide.ropensci.org`

- All tools available for use now at `github.com/ropensci-review-tools`
